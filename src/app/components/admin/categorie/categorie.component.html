<!-- â”€â”€â”€ Notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="notification" *ngIf="notification" [class.success]="notification.type === 'success'" [class.error]="notification.type === 'error'">
  {{ notification.message }}
</div>

<!-- â”€â”€â”€ Conteneur principal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page-container">

  <!-- En-tÃªte -->
  <div class="page-header">
    <div class="page-title">
      <h1>ğŸ·ï¸ Gestion des catÃ©gories</h1>
      <span class="badge-count">{{ filteredCategories.length }} catÃ©gorie{{ filteredCategories.length > 1 ? 's' : '' }}</span>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="openMultipleModal()">
        â• Import multiple
      </button>
      <button class="btn btn-primary" (click)="openCreateModal()">
        â• Nouvelle catÃ©gorie
      </button>
    </div>
  </div>

  <!-- Filtres & recherche -->
  <div class="toolbar">
    <div class="view-tabs">
      <button class="tab" [class.active]="viewMode === 'all'" (click)="switchView('all')">
        Toutes
      </button>
      <button class="tab" [class.active]="viewMode === 'valides'" (click)="switchView('valides')">
        Actives uniquement
      </button>
    </div>
    <div class="search-box">
      <span class="search-icon">ğŸ”</span>
      <input
        type="text"
        placeholder="Rechercher une catÃ©gorie..."
        [(ngModel)]="searchQuery"
        (input)="applySearch()"
      />
      <button *ngIf="searchQuery" class="clear-btn" (click)="searchQuery = ''; applySearch()">âœ•</button>
    </div>
  </div>

  <!-- Loader -->
  <div class="loader-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Chargement...</p>
  </div>

  <!-- Tableau -->
  <div class="table-wrapper" *ngIf="!loading">
    <table class="data-table" *ngIf="filteredCategories.length > 0; else emptyState">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Statut</th>
          <th>CrÃ©Ã©e le</th>
          <th>ModifiÃ©e le</th>
          <th class="col-actions">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let cat of filteredCategories">
          <td class="cell-nom">{{ cat.nom }}</td>
          <td>
            <span class="badge" [class.badge-active]="cat.valide" [class.badge-inactive]="!cat.valide">
              {{ cat.valide ? 'âœ… Active' : 'â›” Inactive' }}
            </span>
          </td>
          <td class="cell-date">{{ cat.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
          <td class="cell-date">{{ cat.updatedAt | date:'dd/MM/yyyy HH:mm' }}</td>
          <td class="cell-actions">
            <button class="btn-icon btn-toggle" [title]="cat.valide ? 'DÃ©sactiver' : 'Activer'" (click)="doToggle(cat)">
              {{ cat.valide ? 'ğŸ”•' : 'ğŸ””' }}
            </button>
            <button class="btn-icon btn-edit" title="Modifier" (click)="openEditModal(cat)">
              âœï¸
            </button>
            <button class="btn-icon btn-delete" title="Supprimer" (click)="confirmDelete(cat)">
              ğŸ—‘ï¸
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Ã‰tat vide -->
    <ng-template #emptyState>
      <div class="empty-state">
        <span class="empty-icon">ğŸ·ï¸</span>
        <p>Aucune catÃ©gorie trouvÃ©e</p>
        <span *ngIf="searchQuery">pour la recherche "{{ searchQuery }}"</span>
      </div>
    </ng-template>
  </div>

</div> <!-- FIN du page-container -->

<!-- ========== TOUS LES MODALS PLACÃ‰S ICI, EN DEHORS DU page-container ========== -->

<!-- â”€â”€â”€ Modal CrÃ©er / Modifier â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay" *ngIf="modalMode === 'create' || modalMode === 'edit'" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ modalMode === 'edit' ? 'âœï¸ Modifier la catÃ©gorie' : 'â• Nouvelle catÃ©gorie' }}</h2>
      <button class="modal-close" (click)="closeModal()">âœ•</button>
    </div>

    <div class="modal-body">
      <div class="form-group" [class.has-error]="formErrors.nom">
        <label for="cat-nom">Nom <span class="required">*</span></label>
        <input
          id="cat-nom"
          type="text"
          [(ngModel)]="form.nom"
          placeholder="Ex : Ã‰lectronique"
          (keyup.enter)="saveForm()"
        />
        <span class="error-msg" *ngIf="formErrors.nom">{{ formErrors.nom }}</span>
      </div>

      <div class="form-group">
        <label class="toggle-label">
          <div class="toggle-switch" [class.on]="form.valide" (click)="form.valide = !form.valide">
            <div class="toggle-thumb"></div>
          </div>
          <span>{{ form.valide ? 'Active' : 'Inactive' }}</span>
        </label>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-ghost" (click)="closeModal()" [disabled]="saving">Annuler</button>
      <button class="btn btn-primary" (click)="saveForm()" [disabled]="saving">
        <span *ngIf="saving" class="spinner-sm"></span>
        {{ saving ? 'Enregistrement...' : (modalMode === 'edit' ? 'Mettre Ã  jour' : 'CrÃ©er') }}
      </button>
    </div>
  </div>
</div>

<!-- â”€â”€â”€ Modal Import multiple â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay" *ngIf="modalMode === 'multiple'" (click)="closeModal()">
  <div class="modal modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>â• Import multiple</h2>
      <button class="modal-close" (click)="closeModal()">âœ•</button>
    </div>

    <div class="modal-body">
      <p class="hint">Collez un tableau JSON de catÃ©gories. Exemple :</p>
      <pre class="code-hint">[
  {{ '{' }} "nom": "Ã‰lectronique", "valide": true {{ '}' }},
  {{ '{' }} "nom": "VÃªtements" {{ '}' }}
]</pre>

      <div class="form-group" [class.has-error]="multipleError">
        <label>JSON</label>
        <textarea
          [(ngModel)]="multipleRaw"
          rows="10"
          placeholder='[{ "nom": "...", "valide": true }]'
        ></textarea>
        <span class="error-msg" *ngIf="multipleError" style="white-space: pre-line">{{ multipleError }}</span>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-ghost" (click)="closeModal()" [disabled]="saving">Annuler</button>
      <button class="btn btn-primary" (click)="saveMultiple()" [disabled]="saving">
        <span *ngIf="saving" class="spinner-sm"></span>
        {{ saving ? 'Import en cours...' : 'Importer' }}
      </button>
    </div>
  </div>
</div>

<!-- â”€â”€â”€ Confirmation suppression â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay" *ngIf="deleteTarget" (click)="cancelDelete()">
  <div class="modal modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>ğŸ—‘ï¸ Confirmer la suppression</h2>
      <button class="modal-close" (click)="cancelDelete()">âœ•</button>
    </div>
    <div class="modal-body">
      <p>Voulez-vous vraiment supprimer la catÃ©gorie <strong>{{ deleteTarget?.nom }}</strong> ?</p>
      <p class="hint danger">Cette action est irrÃ©versible.</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" (click)="cancelDelete()">Annuler</button>
      <button class="btn btn-danger" (click)="doDelete()">Supprimer</button>
    </div>
  </div>
</div>

<!-- Petit indicateur de dÃ©bogage (Ã  supprimer plus tard) -->
<div *ngIf="modalMode" style="position: fixed; top: 10px; left: 10px; background: red; color: white; padding: 5px 10px; border-radius: 4px; z-index: 10000; font-size: 12px;">
  Modal actif: {{ modalMode }}
</div>