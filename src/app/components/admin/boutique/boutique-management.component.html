<div class="container-fluid py-4">
  <!-- En-tête -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>
      <i class="bi bi-shop me-2"></i>
      Gestion des boutiques
    </h2>
    <button class="btn btn-primary" (click)="loadBoutiques()">
      <i class="bi bi-arrow-repeat me-1"></i>
      Rafraîchir
    </button>
  </div>

  <!-- Messages d'alerte -->
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    {{ error }}
    <button type="button" class="btn-close" (click)="error = null"></button>
  </div>

  <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="bi bi-check-circle-fill me-2"></i>
    {{ successMessage }}
    <button type="button" class="btn-close" (click)="successMessage = null"></button>
  </div>

  <!-- Filtres et recherche -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <div class="input-group">
            <span class="input-group-text bg-white">
              <i class="bi bi-search"></i>
            </span>
            <input 
              type="text" 
              class="form-control" 
              placeholder="Rechercher par nom, email ou téléphone..."
              [(ngModel)]="searchTerm"
              (ngModelChange)="onSearchChange()"
            >
          </div>
        </div>
        <div class="col-md-4">
          <select class="form-select" [(ngModel)]="activeFilter" (ngModelChange)="onFilterChange()">
            <option value="all">Toutes les boutiques</option>
            <option value="active">Boutiques actives</option>
            <option value="inactive">Boutiques inactives</option>
          </select>
        </div>
        <div class="col-md-2">
          <select class="form-select" [(ngModel)]="pagination.itemsPerPage" (ngModelChange)="loadBoutiques()">
            <option [value]="10">10 par page</option>
            <option [value]="25">25 par page</option>
            <option [value]="50">50 par page</option>
            <option [value]="100">100 par page</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Tableau des boutiques -->
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="bg-light">
            <tr>
              <th class="ps-4">#</th>
              <th>Boutique</th>
              <th>Contact</th>
              <th>Box</th>
              <th>Statut</th>
              <th>Date création</th>
              <th class="text-end pe-4">Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Loading state -->
            <tr *ngIf="loading">
              <td colspan="8" class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Chargement...</span>
                </div>
                <p class="text-muted mt-2 mb-0">Chargement des boutiques...</p>
              </td>
            </tr>

            <!-- No data state -->
            <tr *ngIf="!loading && boutiques.length === 0">
              <td colspan="8" class="text-center py-5">
                <i class="bi bi-shop display-1 text-muted"></i>
                <p class="text-muted mt-3 mb-0">Aucune boutique trouvée</p>
              </td>
            </tr>

            <!-- Boutiques list -->
            <tr *ngFor="let boutique of boutiques; let i = index">
              <td class="ps-4 fw-medium">{{ i + 1 + (pagination.currentPage - 1) * pagination.itemsPerPage }}</td>
              <td>
                <div class="fw-medium">{{ boutique.nom }}</div>
                <small class="text-muted">ID: {{ boutique._id | slice: -6 }}</small>
              </td>
              <td>
                <div>
                  <i class="bi bi-envelope-fill me-1 text-muted small"></i>
                  {{ boutique.nom }}
                </div>
                <div>
                 <span *ngFor="let tel of boutique.contact; let last = last">
                    {{ tel }}{{ !last ? ', ' : '' }}
                    </span>
                </div>
              </td>
              <td>
                <span *ngIf="boutique.box" class="badge bg-info">
                  Box {{ boutique.box.numero }}
                </span>
                <span *ngIf="!boutique.box" class="badge bg-secondary">
                  Non assigné
                </span>
              </td>
              <td>
                <span class="badge {{ getStatusBadgeClass(boutique.active!) }} px-3 py-2">
                  <i class="bi {{ boutique.active ? 'bi-check-circle-fill' : 'bi-x-circle-fill' }} me-1"></i>
                  {{ getStatusText(boutique.active!) }}
                </span>
              </td>
              <td>
                <small class="text-muted">
                  <i class="bi bi-calendar3 me-1"></i>
                  {{ boutique.createdAt | date:'dd/MM/yyyy' }}
                </small>
              </td>
              <td class="text-end pe-4">
                <button 
                  class="btn {{ boutique.active ? 'btn-outline-danger' : 'btn-outline-success' }} btn-sm"
                  (click)="toggleBoutique(boutique)"
                  [disabled]="togglingBoutiqueId === boutique._id"
                >
                  <span *ngIf="togglingBoutiqueId === boutique._id" 
                        class="spinner-border spinner-border-sm me-1" 
                        role="status" 
                        aria-hidden="true">
                  </span>
                  <i class="bi {{ boutique.active ? 'bi-pause-circle' : 'bi-play-circle' }} me-1"></i>
                  {{ boutique.active ? 'Désactiver' : 'Activer' }}
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pagination -->
    <div class="card-footer bg-white border-top" *ngIf="boutiques.length > 0">
      <div class="d-flex justify-content-between align-items-center">
        <div class="text-muted small">
          Affichage de {{ ((pagination.currentPage - 1) * pagination.itemsPerPage) + 1 }} à 
          {{ Math.min(pagination.currentPage * pagination.itemsPerPage, pagination.totalItems) }} 
          sur {{ pagination.totalItems }} boutiques
        </div>
        <nav aria-label="Pagination">
          <ul class="pagination mb-0">
            <li class="page-item" [class.disabled]="pagination.currentPage === 1">
              <button class="page-link" (click)="changePage(pagination.currentPage - 1)">
                <i class="bi bi-chevron-left"></i>
              </button>
            </li>
            <li class="page-item" *ngFor="let page of getPagesArray()" [class.active]="page === pagination.currentPage">
              <button class="page-link" (click)="changePage(page)">{{ page }}</button>
            </li>
            <li class="page-item" [class.disabled]="pagination.currentPage === pagination.totalPages">
              <button class="page-link" (click)="changePage(pagination.currentPage + 1)">
                <i class="bi bi-chevron-right"></i>
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>