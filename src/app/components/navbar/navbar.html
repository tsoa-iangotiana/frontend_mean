<!-- NAVBAR COMPLET (Header seulement) -->
<nav class="navbar-complete">
  <!-- HEADER PRINCIPAL -->
  <div class="header" [class.collapsed]="isSidebarCollapsed">

    <div class="header-left">
      <!-- Bouton toggle mobile -->
      <button
        class="sidebar-toggle-btn"
        (click)="toggleSidebarMobile()"
        *ngIf="isMobile">
        <i class="fas fa-bars"></i>
      </button>

      <!-- Titre -->
      <h1 class="header-title">{{ pageTitle }}</h1>
    </div>

    <!-- Section droite du header -->
    <div class="header-right">
      <!-- Sélecteur de boutique (pour utilisateurs boutique) -->
      <div class="boutique-selector" *ngIf="userRole === 'boutique' && boutiques.length > 0" ngbDropdown container="body">
        <button
          class="boutique-selector-btn"
          ngbDropdownToggle
          type="button"
          id="boutiqueDropdown"
          [disabled]="!hasSelectedBoutique() && boutiques.length === 0">
          <i class="fas fa-store"></i>
          <span class="boutique-name">{{ getSelectedBoutiqueName() }}</span>
          <i class="fas fa-chevron-down"></i>
        </button>
        <div class="dropdown-menu" ngbDropdownMenu aria-labelledby="boutiqueDropdown">
          <h6 class="dropdown-header">Mes boutiques</h6>
          <a
            *ngFor="let boutique of boutiques"
            class="dropdown-item"
            [class.active]="selectedBoutique?._id === boutique._id"
            (click)="selectBoutique(boutique)"
            href="javascript:void(0)">
            <i class="fas fa-store-alt me-2"></i>
            <div class="boutique-item-info">
              <span class="boutique-item-nom">{{ boutique.nom }}</span>
            </div>
            <i *ngIf="selectedBoutique?._id === boutique._id" class="fas fa-check text-success ms-auto"></i>
          </a>
          
          <!-- Message si aucune boutique -->
          <div *ngIf="boutiques.length === 0" class="dropdown-item text-muted text-center">
            <i class="fas fa-store-slash me-2"></i>
            Aucune boutique trouvée
          </div>
        </div>
      </div>

    <!-- Message d'alerte si utilisateur boutique sans boutique -->
    <div class="alert alert-warning alert-sm m-2" *ngIf="userRole === 'boutique' && boutiques.length === 0">
      <i class="fas fa-exclamation-triangle me-2"></i>
      <span>Vous n'avez pas encore de boutique. <a routerLink="/boutique/profil" class="alert-link">Créer une boutique</a></span>
    </div>

      <!-- Panier (pour acheteurs) -->
      <a *ngIf="userRole === 'acheteur'" routerLink="/panier" class="nav-link">
        <i class="fas fa-shopping-cart" style="font-size: 20px; color: var(--primary-color);"></i>
      </a>

      <!-- Menu utilisateur dropdown -->
      <div class="dropdown" ngbDropdown container="body" *ngIf="currentUser">
        <button
          class="user-profile"
          ngbDropdownToggle
          type="button"
          id="userDropdown">
          <div class="user-avatar">{{ getUserInitials() }}</div>
          <span class="user-name">{{ currentUser.username }}</span>
          <i class="fas fa-chevron-down" style="font-size: 12px; color: var(--secondary-color);"></i>
        </button>
        <!-- Dropdown Menu -->
        <div class="dropdown-menu dropdown-menu-end" ngbDropdownMenu>
          <!-- Header du dropdown -->
          <div class="dropdown-header">
            <div class="dropdown-header-content">
              <div class="dropdown-header-avatar">{{ getUserInitials() }}</div>
              <div class="dropdown-header-info">
                <h6>{{ currentUser.username }}</h6>
                <p>{{ getRoleLabel() }}</p>
              </div>
            </div>
          </div>

          <div class="dropdown-divider"></div>

          <!-- Menu items -->
          <a class="dropdown-item" routerLink="/profile" (click)="closeSidebarMobile()">
            <i class="fas fa-user"></i>
            <span>Mon Profil</span>
          </a>

          <a class="dropdown-item" routerLink="/settings" (click)="closeSidebarMobile()">
            <i class="fas fa-cog"></i>
            <span>Paramètres</span>
          </a>

          <div class="dropdown-divider"></div>

          <!-- Déconnexion -->
          <a class="dropdown-item text-danger" (click)="logout(); closeSidebarMobile()" href="javascript:void(0)">
            <i class="fas fa-sign-out-alt"></i>
            <span>Déconnexion</span>
          </a>
        </div>
      </div>

      <!-- Login si pas connecté -->
      <a *ngIf="!currentUser" routerLink="/login" class="btn btn-primary">
        Connexion
      </a>
    </div>
  </div>
</nav>

<!-- SIDEBAR FIXE (EN DEHORS DU NAV) -->
<div class="sidebar" [class.collapsed]="isSidebarCollapsed" [class.show]="isSidebarMobileShow">
  <!-- LOGO SIDEBAR -->

  <!-- MENU NAVIGATION SIDEBAR -->
  <ul class="sidebar-menu">
    <!-- Items de navigation pour tous les utilisateurs -->
    <ng-container *ngFor="let item of navItems">
      <!-- Item simple sans sous-menu -->
      <li *ngIf="!item.children">
        <a
          [routerLink]="[item.route]"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: item.exact }"
          (click)="closeSidebarMobile()"
          class="sidebar-link">
          <i class="fas fa-{{ item.icon }}"></i>
          <span>{{ item.label }}</span>
          <span class="badge badge-danger ms-auto" *ngIf="item.badge">
            {{ item.badge }}
          </span>
        </a>
      </li>

      <!-- Item avec sous-menu -->
      <li *ngIf="item.children" class="sidebar-item" [class.open]="isSubmenuOpen(item.label)">
        <a
          href="javascript:void(0)"
          (click)="toggleSubmenu(item.label)"
          class="sidebar-link">
          <i class="fas fa-{{ item.icon }}"></i>
          <span>{{ item.label }}</span>
          <i class="fas fa-chevron-down ms-auto" *ngIf="!isSidebarCollapsed"></i>
        </a>

        <!-- Sous-menu items -->
        <ul class="sidebar-submenu" *ngIf="isSubmenuOpen(item.label)">
          <li *ngFor="let child of item.children">
            <a
              [routerLink]="[child.route]"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: child.exact }"
              (click)="closeSidebarMobile()">
              <i class="fas fa-{{ child.icon }}"></i>
              <span>{{ child.label }}</span>
            </a>
          </li>
        </ul>
      </li>
    </ng-container>
  </ul>
</div>

<!-- OVERLAY MOBILE -->
<div
  class="sidebar-overlay"
  [class.show]="isSidebarMobileShow"
  (click)="closeSidebarMobile()">
</div>
